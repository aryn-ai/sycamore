# To start, run:
# % docker compose up
#
# What you should see:
#   1. wait while containers are downloaded (speed depends on your network), or nothing once cached
#   2a. crawler should run and download 1 sample pdf
#   2b. demo ui starting (in parallel with 2a)
#   3. lots of logging as opensearch starts. Eventually 'Waiting for opensearch to exit.'
#   4. sycamore container downloading pytorch files then running ray to import
#   5. UI ready to go on port localhost:3000 (it's accessible before this but won't work)
#
# Troubleshooting/Extensions:
#   1. Something is messed up, I just want to reset:
#      Follow the instructions in reset.yaml
#   2. I want more sort benchmark files:
#      Follow the instructions in sort-all.yaml
version: '3'

services:
  demo-ui:
    image: arynai/demo-ui
    ports:
      - 127.0.0.1:3000:3000 # UI port
      - 127.0.0.1:3001:3001 # proxy port
    environment:
      - OPENAI_API_KEY
      - OPENSEARCH_HOST=opensearch
  opensearch:
    image: arynai/opensearch
    ports:
      - 127.0.0.1:9200:9200 # opensearch port, directly accessed by UI
    volumes:
      - opensearch_data:/usr/share/opensearch/data
    environment:
      - OPENAI_API_KEY
  sycamore:
    image: arynai/sycamore
    ports:
      - 127.0.0.1:8265:8265 # ray console port
    volumes:
      - crawl_data:/app/.scrapy
    environment:
      - OPENAI_API_KEY
    shm_size: "4gb"
  sycamore_crawler_http:
    image: arynai/sycamore-crawler-http
    volumes:
      - crawl_data:/app/.scrapy

volumes:
  opensearch_data:
  crawl_data:
